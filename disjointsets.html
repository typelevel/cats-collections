<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Disjoint Sets</title>
  
  <meta name="author" content="cats-collections contributors"/>
  
  <meta name="author" content="Nicolas A Perez"/>
  
  
  <meta name="description" content="docs"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="helium/site/laika-helium.css" />
  <script src="helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="https://typelevel.org"><img src="https://typelevel.org/img/logo.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/cats-collections"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://github.com/typelevel/cats-collections"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@typelevel"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="index.html">Cats-Collections</a></li>
    <li class="level1 nav-leaf"><a href="binaryheap.html">Binary Heap</a></li>
    <li class="level1 nav-leaf"><a href="dequeue.html">Dequeue</a></li>
    <li class="level1 nav-leaf"><a href="diet.html">Diet</a></li>
    <li class="level1 nav-leaf"><a href="discrete.html">Discrete</a></li>
    <li class="level1 active nav-leaf"><a href="#">Disjoint Sets</a></li>
    <li class="level1 nav-leaf"><a href="predicate.html">Predicate</a></li>
    <li class="level1 nav-leaf"><a href="range.html">Range</a></li>
    <li class="level1 nav-leaf"><a href="set.html">AvlSet</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Disjoint Sets</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#supported-operations">Supported operations</a></li>
    <li class="level1 nav-leaf"><a href="#example-usage">Example usage</a></li>
    <li class="level1 nav-node"><a href="#structure-and-performance">Structure and performance</a></li>
    <li class="level2 nav-leaf"><a href="#heuristics">Heuristics</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="disjoint-sets" class="title">Disjoint Sets</h1>
        <p><code>DisjointSets</code> provides a purely functional implementation for the union-find collection.
        An Union-Find (aka Disjoint Sets) structure is a set of sets where the intersection of any two sets is empty.</p>
        <p><img src="http://i.imgur.com/K7BwoOk.png" alt=""></p>
        <p><img src="http://i.imgur.com/SkqEdwt.png" alt=""></p>
        <p>This constraint opens the way to fast unions (<code>O(1)</code> average). That makes of Disjoint Sets the perfect tool for
         clustering algorithms such as calculating the connected components in a graph.</p>
        <p>Initially, it is a flat collection where each element forms its own, size 1, disjoint set.
        New elements are added as new disjoint sets and union operations can be used to fusion these sets.
        The joined sets are represented by one of its elements known as <strong><em>label</em> or <em>root</em></strong>.</p>
        <p>Fast fusion of disjoints sets is key and its provided through parenthood relations. Sets <code>labels</code> are always the
        top-level ancestor.</p>
        <p>The following example shows 3 disjoint sets of size 1.</p>
        <p><img src="http://i.imgur.com/h8ddOkT.png" alt=""></p>
        <p>Whereas, in the next one, <code>C</code> is the parent of the <code>{A, B, C}</code> set which is the only set in the DisjointSets structure.</p>
        <p><img src="http://i.imgur.com/V71Z0eS.png" alt=""></p>
        
        <h2 id="supported-operations" class="section"><a class="anchor-link left" href="#supported-operations"><i class="icofont-laika link">&#xef71;</i></a>Supported operations</h2>
        <ul>
          <li><code>dsets + c</code> (add): Adds a value as a single element set:</li>
        </ul>
        <p><img src="http://i.imgur.com/iA00VgQ.png" alt=""></p>
        <ul>
          <li><code>desets.union(A,C)</code> (union/join): Fusion two disjoint sets:</li>
        </ul>
        <p><img src="http://i.imgur.com/7uunsNJ.png" alt=""></p>
        <ul>
          <li>
            <p><code>dsets.find(v)</code> (find): Retrieves <code>Some(label)</code> if <code>v</code> belongs to the set with that label or <code>None</code> if the
            value is not part of <code>dsets</code>.</p>
          </li>
          <li>
            <p><code>dsets.toSets</code>: Gets a <code>Map[T, Set[T]]</code> representation of the DisjointSets contents where the key is each set
            <em>label</em>.</p>
          </li>
        </ul>
        
        <h2 id="example-usage" class="section"><a class="anchor-link left" href="#example-usage"><i class="icofont-laika link">&#xef71;</i></a>Example usage</h2>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="type-name">DisjointSets</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">operations</span><span> = </span><span class="keyword">for</span><span> {
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">union</span><span>(</span><span class="number-literal">1</span><span>,</span><span class="number-literal">2</span><span>)
  </span><span class="identifier">oneAndTwo</span><span> &lt;- </span><span class="identifier">find</span><span>(</span><span class="number-literal">2</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">union</span><span>(</span><span class="number-literal">3</span><span>,</span><span class="number-literal">4</span><span>)
  </span><span class="identifier">threeAndFour</span><span> &lt;- </span><span class="identifier">find</span><span>(</span><span class="number-literal">3</span><span>)
  </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">union</span><span>(</span><span class="number-literal">2</span><span>,</span><span class="number-literal">3</span><span>)
  </span><span class="identifier">sets</span><span> &lt;- </span><span class="identifier">toSets</span><span>
} </span><span class="keyword">yield</span><span> </span><span class="identifier">sets</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">label2disjointset</span><span>: </span><span class="type-name">Map</span><span>[</span><span class="type-name">Int</span><span>, </span><span class="type-name">Set</span><span>[</span><span class="type-name">Int</span><span>]] = </span><span class="identifier">operations</span><span>.</span><span class="identifier">runA</span><span>(</span><span class="type-name">DisjointSets</span><span>(</span><span class="number-literal">1</span><span>,</span><span class="number-literal">2</span><span>,</span><span class="number-literal">3</span><span>,</span><span class="number-literal">4</span><span>)).</span><span class="identifier">value</span></code></pre>
        
        <h2 id="structure-and-performance" class="section"><a class="anchor-link left" href="#structure-and-performance"><i class="icofont-laika link">&#xef71;</i></a>Structure and performance</h2>
        <p>The main idea is that each element starts as a disjoint set itself. A set with two or more elements is always the result of one or several <em>union</em> operations. Thus, a multi-element set is composed of sets of just one element, call them components.</p>
        <p>Each component has 3 fields:</p>
        <ul>
          <li>One for the value of the element it contains.</li>
          <li>A reference pointing to another component of the same composed multi-element set. Or itself if it constitutes a single element set.</li>
          <li>An estimation of how many components/nodes compose its descendants. This estimation is known as <strong>rank</strong>.</li>
        </ul>
        <p>Let’s assume that the next operations are executed:</p>
        <pre><code>dsets.union(B,A) //1
dsets.union(B,C) //2</code></pre>
        <p>From a mathematical point of view, the result should be similar to the one shown below:</p>
        <p><img src="http://i.imgur.com/V71Z0eS.png" alt=""></p>
        <p>However, in order to improve lookups performance, some optimizations need to be applied. Therefore, with optimized
        operations, the resulting structure after (1) and (2) is:</p>
        <p><img src="http://i.imgur.com/9srckn2.png" alt=""></p>
        <p>Each set is a tree represented by its <em>root</em>. Therefore, looking for the set an element belongs to is not more than
        following its parental relations until the root of the tree is reached. So the shallower the tree is, the fewer
        the operations to be performed in the lookup are.</p>
        <p>On the other hand, the operation where two sets are merged (<em>union</em>) consist on making one of the two trees to become a
        branch of the other:</p>
        <p><img src="http://i.imgur.com/aKHPrtV.png" alt=""></p>
        
        <h3 id="heuristics" class="section"><a class="anchor-link left" href="#heuristics"><i class="icofont-laika link">&#xef71;</i></a>Heuristics</h3>
        <p>These are two optimizations whose goal is to reduce the depth of each tree representing a set. The lower the tree height is,
        the fewer operations are needed to find one element set  label.</p>
        <p>Considering <code>DisjointSets</code> structure as a forest of tree-sets, let’s compute <img src="http://i.imgur.com/wgbq86Y.png" alt=""> as the maximum tree height of the
        forest.
        The maximum number of operations to complete before finding one element in one set is proportional to the number of
        jumps from the deepest leaf to its tree root. That is <img src="http://i.imgur.com/DR5IUP3.png" alt="">.</p>
        <p>There are two heuristics designed to keep these tress low:</p>
        <ul>
          <li><strong>Union by rank:</strong>  Avoids incrementing <img src="http://i.imgur.com/DR5IUP3.png" alt=""> whenever possible. The idea is for each
          value node to store how many levels have the sub-tree that they are ancestor of (call it rank). All new elements
          have a rank value of 0 (the <em>root</em> is the first level). This way, whenever an <em>union</em> operation is
          executed, is the shorter tree the one that becomes a branch of the other and, therefore, <img src="http://i.imgur.com/DR5IUP3.png" alt=""> does not increase.</li>
          <li><strong>Path compression:</strong> In this case the aim is to take advantage of the jumps made in <em>find</em> operation. Whenever a tree
          <em>root</em> is found it is assigned to every node in the search path. This is a purely functional data structure so the
          changes are reflected in a new copy of it which forms part of the operation result.</li>
        </ul>

        
<hr class="footer-rule"/>
<footer>
  cats-collections is a <a href="https://typelevel.org/">Typelevel</a> project distributed under the <a href="https://opensource.org/licenses/MIT">MIT</a> license.
</footer>


      </main>

    </div>

  </body>

</html>